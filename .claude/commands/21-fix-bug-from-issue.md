---
name: fix-bug-from-issue
description: 分析并修复bug by github issue URL
---

# 分析并修复 Bug（基于 GitHub Issue）

## 任务
根据提供的 GitHub Issue URL，分析问题并实施修复。

## 工作流程

### 1. Issue 分析阶段
- **获取 Issue 内容**：使用 `gh issue view <issue-number>` 或 WebFetch 获取完整 issue 内容
- **理解问题**：
  - 问题描述：用户报告的具体现象
  - 复现步骤：如何触发该 bug
  - 预期行为 vs 实际行为
  - 环境信息：浏览器、操作系统、版本等
  - 相关日志或错误信息
- **提取关键信息**：
  - 受影响的功能模块
  - 错误类型（前端/后端/数据库/集成等）
  - 严重程度（critical/high/medium/low）
  - 相关的文件或组件

### 2. 问题定位阶段
- **代码搜索**：
  - 根据错误信息定位相关代码
  - 使用 Grep 搜索关键函数、错误消息、组件名
  - 使用 Explore agent 探索相关模块
- **日志分析**：
  - 检查相关的日志文件
  - 查找错误堆栈信息
- **依赖分析**：
  - 检查最近的代码变更（git log, git blame）
  - 确认是否由最近的提交引入
  - 分析相关依赖关系

### 3. 根本原因分析
- **确定根因**：
  - 是逻辑错误、边界条件未处理、还是状态管理问题？
  - 是否有竞态条件或时序问题？
  - 是否是配置错误或环境问题？
- **影响范围评估**：
  - 该问题影响哪些用户场景？
  - 是否有其他地方存在类似问题？
  - 修复是否会影响其他功能？

### 4. 修复方案设计
- **设计修复方案**：
  - 提出至少 2 种可能的修复方案
  - 评估每种方案的优缺点
  - 选择最合适的方案（考虑：风险、复杂度、维护性）
- **使用 TodoWrite 规划任务**：
  - 列出具体的修复步骤
  - 包含测试验证步骤
  - 包含文档更新（如需要）

### 5. 实施修复
- **代码修改**：
  - 遵循项目代码规范
  - 最小化改动范围
  - 添加必要的注释说明修复原因
- **安全检查**（Web3 AI 交易系统）：
  - 如果涉及交易、密钥、AI 决策等，必须进行安全审查
  - 确保不引入新的安全漏洞
  - 参考 /20-code-review 中的安全检查清单

### 6. 测试验证
- **单元测试**：
  - 为修复的代码添加或更新单元测试
  - 确保测试覆盖原问题场景
  - 确保测试覆盖边界情况
- **集成测试**：
  - 验证修复后功能正常
  - 验证不影响其他功能
- **手动验证**：
  - 按照 issue 中的复现步骤验证
  - 验证预期行为正确
  - 测试相关的边界情况

### 7. 文档更新
- **代码注释**：添加必要的注释说明修复逻辑
- **CHANGELOG**：如果项目有 changelog，添加修复记录
- **Issue 更新**：准备在 issue 中回复修复说明

## 输出要求

### 修复报告
请提供以下内容：

1. **问题摘要**
   - Issue URL 和标题
   - 问题描述一句话总结
   - 严重程度评估

2. **根本原因分析**
   - 问题的技术根因（附文件路径:行号）
   - 为什么会出现这个问题
   - 影响范围

3. **修复方案**
   - 选择的修复方案说明
   - 为什么选择这个方案
   - 修改的文件列表（文件路径:行号）

4. **测试验证**
   - 执行的测试类型
   - 测试结果
   - 复现步骤验证结果

5. **后续建议**（可选）
   - 是否需要进一步重构
   - 相关技术债务
   - 预防类似问题的建议

## 关键原则

1. **准确理解问题**：确保完全理解 issue 描述的问题
2. **最小化改动**：只改需要改的，避免过度工程
3. **彻底测试**：确保修复有效且不引入新问题
4. **清晰沟通**：提供清晰的修复说明和验证结果
5. **安全优先**：对于资金、密钥相关的修复，安全是第一位

## 开始执行

请提供 GitHub Issue URL（格式：https://github.com/owner/repo/issues/number），我将立即开始分析和修复。
